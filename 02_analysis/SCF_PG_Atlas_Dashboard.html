<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SCF Public Goods Atlas — Intelligence Dashboard</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
  :root {
    --bg: #0a0e1a;
    --surface: #111827;
    --surface2: #1a2233;
    --border: #1e2d45;
    --accent: #3b82f6;
    --accent2: #8b5cf6;
    --accent3: #06b6d4;
    --accent4: #10b981;
    --warn: #f59e0b;
    --danger: #ef4444;
    --text: #e2e8f0;
    --muted: #64748b;
    --pg-blue: #3b82f6;
    --pg-purple: #8b5cf6;
    --infra-teal: #06b6d4;
    --dev-green: #10b981;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    line-height: 1.5;
    min-height: 100vh;
  }

  /* ── Header ───────────────────────────────────────────────── */
  .header {
    background: linear-gradient(135deg, #0a0e1a 0%, #111827 50%, #0f172a 100%);
    border-bottom: 1px solid var(--border);
    padding: 28px 40px 24px;
    position: relative;
    overflow: hidden;
  }
  .header::before {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(ellipse at 70% 50%, rgba(59,130,246,0.08) 0%, transparent 60%),
                radial-gradient(ellipse at 20% 80%, rgba(139,92,246,0.06) 0%, transparent 50%);
    pointer-events: none;
  }
  .header-inner { position: relative; max-width: 1400px; margin: 0 auto; }
  .badge {
    display: inline-flex; align-items: center; gap: 6px;
    background: rgba(59,130,246,0.12); border: 1px solid rgba(59,130,246,0.3);
    color: var(--accent); border-radius: 20px; padding: 4px 12px;
    font-size: 11px; font-weight: 600; letter-spacing: 0.05em; text-transform: uppercase;
    margin-bottom: 12px;
  }
  .badge-dot { width: 6px; height: 6px; background: #22c55e; border-radius: 50%; animation: pulse 2s infinite; }
  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.4} }
  h1 { font-size: 28px; font-weight: 700; letter-spacing: -0.5px; color: #f8fafc; }
  h1 span { background: linear-gradient(90deg, var(--accent), var(--accent2)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
  .subtitle { color: var(--muted); font-size: 13px; margin-top: 6px; }
  .subtitle strong { color: #94a3b8; }

  /* ── Layout ───────────────────────────────────────────────── */
  .main { max-width: 1400px; margin: 0 auto; padding: 32px 40px; }

  /* ── KPI Cards ───────────────────────────────────────────── */
  .kpi-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 12px; margin-bottom: 28px; }
  .kpi {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 18px 16px;
    position: relative;
    overflow: hidden;
    transition: border-color 0.2s;
  }
  .kpi:hover { border-color: var(--accent); }
  .kpi::before {
    content: '';
    position: absolute; top: 0; left: 0; right: 0; height: 2px;
  }
  .kpi.blue::before  { background: linear-gradient(90deg, var(--accent), transparent); }
  .kpi.purple::before{ background: linear-gradient(90deg, var(--accent2), transparent); }
  .kpi.teal::before  { background: linear-gradient(90deg, var(--accent3), transparent); }
  .kpi.green::before { background: linear-gradient(90deg, var(--accent4), transparent); }
  .kpi.warn::before  { background: linear-gradient(90deg, var(--warn), transparent); }
  .kpi.danger::before{ background: linear-gradient(90deg, var(--danger), transparent); }

  .kpi-label { font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.08em; color: var(--muted); }
  .kpi-value { font-size: 26px; font-weight: 800; letter-spacing: -1px; margin: 6px 0 2px; color: #f8fafc; }
  .kpi-sub { font-size: 11px; color: var(--muted); }

  /* ── Section headers ─────────────────────────────────────── */
  .section { margin-bottom: 28px; }
  .section-header { display: flex; align-items: center; gap: 10px; margin-bottom: 16px; }
  .section-title { font-size: 14px; font-weight: 700; color: #cbd5e1; text-transform: uppercase; letter-spacing: 0.06em; }
  .section-pill {
    font-size: 10px; font-weight: 600; padding: 2px 8px; border-radius: 10px;
    background: rgba(59,130,246,0.12); color: var(--accent); border: 1px solid rgba(59,130,246,0.2);
  }
  .legend-box {
    margin-top: 10px;
    background: rgba(255,255,255,0.02);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 10px 14px;
    font-size: 11px;
    color: var(--muted);
    line-height: 1.7;
  }
  .legend-box strong { color: #94a3b8; }

  /* ── Chart grid ──────────────────────────────────────────── */
  .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
  .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 20px; }
  .grid-1-2 { display: grid; grid-template-columns: 1fr 2fr; gap: 20px; margin-bottom: 20px; }
  .grid-2-1 { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 20px; }

  .card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 20px;
    position: relative;
  }
  .card-title {
    font-size: 12px; font-weight: 700; color: #94a3b8;
    text-transform: uppercase; letter-spacing: 0.06em;
    margin-bottom: 16px;
    display: flex; align-items: center; justify-content: space-between;
  }
  .card-tag {
    font-size: 9px; font-weight: 600; padding: 2px 6px; border-radius: 6px;
    background: rgba(139,92,246,0.15); color: var(--accent2);
    border: 1px solid rgba(139,92,246,0.25); letter-spacing: 0.05em;
  }
  .chart-wrap { position: relative; }
  .chart-wrap canvas { width: 100% !important; }

  /* ── Seed table ──────────────────────────────────────────── */
  .seed-table { width: 100%; border-collapse: collapse; }
  .seed-table th {
    font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.06em;
    color: var(--muted); padding: 0 8px 10px; text-align: left; border-bottom: 1px solid var(--border);
  }
  .seed-table td { padding: 9px 8px; font-size: 12px; border-bottom: 1px solid rgba(30,45,69,0.5); vertical-align: middle; }
  .seed-table tr:last-child td { border-bottom: none; }
  .seed-table tr:hover td { background: rgba(59,130,246,0.04); }
  .rank { color: var(--muted); font-weight: 700; font-size: 11px; width: 24px; }
  .proj-name { font-weight: 600; color: #e2e8f0; max-width: 160px; }
  .cat-badge {
    display: inline-block; font-size: 9px; font-weight: 700; padding: 2px 7px; border-radius: 6px;
    white-space: nowrap;
  }
  .cat-infra { background: rgba(6,182,212,0.12); color: var(--accent3); border: 1px solid rgba(6,182,212,0.25); }
  .cat-dev   { background: rgba(16,185,129,0.12); color: var(--accent4); border: 1px solid rgba(16,185,129,0.25); }
  .status-dot { display: inline-block; width: 6px; height: 6px; border-radius: 50%; margin-right: 5px; }
  .status-mainnet { background: #22c55e; }
  .status-development { background: var(--warn); }
  .status-testnet { background: var(--accent); }
  .usd-bar-wrap { display: flex; align-items: center; gap: 8px; }
  .usd-bar { height: 5px; background: linear-gradient(90deg, var(--accent), var(--accent2)); border-radius: 3px; }
  .usd-val { font-size: 11px; font-weight: 700; color: #94a3b8; white-space: nowrap; }

  /* ── Funnel bars ─────────────────────────────────────────── */
  .funnel-item { margin-bottom: 14px; }
  .funnel-label { display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 6px; }
  .funnel-label span:first-child { font-weight: 600; color: #cbd5e1; }
  .funnel-label span:last-child { color: var(--muted); font-weight: 600; }
  .funnel-track { background: rgba(255,255,255,0.05); border-radius: 4px; height: 8px; overflow: hidden; }
  .funnel-fill { height: 100%; border-radius: 4px; }

  /* ── Footer ──────────────────────────────────────────────── */
  .footer {
    border-top: 1px solid var(--border);
    padding: 20px 40px;
    max-width: 1400px; margin: 0 auto;
    display: flex; justify-content: space-between; align-items: center;
    font-size: 11px; color: var(--muted);
  }
  .footer strong { color: #475569; }
</style>
</head>
<body>

<!-- ── HEADER ──────────────────────────────────────────────── -->
<div class="header">
  <div class="header-inner">
    <div class="badge">
      <span class="badge-dot"></span>
      SCF #41 — Panel Review · Vote closes Mar 1, 2026
    </div>
    <h1>SCF Public Goods <span>Atlas Intelligence</span></h1>
    <p class="subtitle">
      Airtable data export · Feb 24, 2026 &nbsp;|&nbsp;
      <strong>579 projects · 758 submissions · 48 rounds · $52.9M awarded</strong>
      &nbsp;|&nbsp; Jay Gutierrez, PhD &mdash; Graph Analytics Lead
    </p>
  </div>
</div>

<!-- ── MAIN ────────────────────────────────────────────────── -->
<div class="main">

<!-- KPI Strip -->
<div class="kpi-grid">
  <div class="kpi blue">
    <div class="kpi-label">Total Ecosystem Funding</div>
    <div class="kpi-value">$52.9M</div>
    <div class="kpi-sub">579 awarded projects · 48 rounds</div>
  </div>
  <div class="kpi green">
    <div class="kpi-label">Active Projects</div>
    <div class="kpi-value">345</div>
    <div class="kpi-sub">Mainnet / Development / Expansion</div>
  </div>
  <div class="kpi purple">
    <div class="kpi-label">PG Atlas Seeds</div>
    <div class="kpi-value">86</div>
    <div class="kpi-sub">Dev Tooling + Infra · Soroban · GitHub</div>
  </div>
  <div class="kpi teal">
    <div class="kpi-label">Soroban Projects</div>
    <div class="kpi-value">387</div>
    <div class="kpi-sub">67% of all awarded projects</div>
  </div>
  <div class="kpi warn">
    <div class="kpi-label">GitHub Orgs (A6 Roots)</div>
    <div class="kpi-value">78</div>
    <div class="kpi-sub">Crawl seeds for registry pipeline</div>
  </div>
  <div class="kpi danger">
    <div class="kpi-label">A7 Repo Targets</div>
    <div class="kpi-value">338</div>
    <div class="kpi-sub">Submission-level git log candidates</div>
  </div>
</div>

<!-- Row 1: Funding by Category + Round Funding Trend -->
<div class="grid-1-2">
  <div class="card">
    <div class="card-title">
      Ecosystem Funding by Category
      <span class="card-tag">$52.9M Total</span>
    </div>
    <div class="chart-wrap"><canvas id="catChart" height="220"></canvas></div>
    <div class="legend-box">
      <strong>PG Atlas focus</strong>: Developer Tooling ($10M, 127 projects) + Infrastructure & Services ($8.2M, 90 projects) are the two categories that form the PG candidate universe — together <strong>$18.3M, 38%</strong> of the ecosystem by value.
      Applications dominate by volume but are downstream consumers of PG infrastructure, not PG candidates themselves.
    </div>
  </div>
  <div class="card">
    <div class="card-title">
      Round-over-Round Funding &amp; Voter Participation
      <span class="card-tag">SCF #3 → #40</span>
    </div>
    <div class="chart-wrap"><canvas id="roundChart" height="220"></canvas></div>
    <div class="legend-box">
      <strong>Bars</strong> = funding per round (USD, left axis). <strong>Line</strong> = voter count (right axis).
      The 2021–2022 era shows high voter counts (310–730) at low funding — a legacy v1–v5 governance model.
      Modern rounds (SCF #30+) stabilize at ~$1.5–2.6M/round with 30–120 informed specialist voters.
      SCF #38–39 show the first meaningful voter uptick alongside record funding — a healthy convergence signal.
    </div>
  </div>
</div>

<!-- Row 2: Top PG Seeds + Status Donut + Tranche Funnel -->
<div class="grid-2-1">
  <div class="card">
    <div class="card-title">
      Top 20 PG Atlas Seed Candidates — by SCF Funding
      <span class="card-tag">A5 Bootstrap Input</span>
    </div>
    <div id="seedTable"></div>
    <div class="legend-box">
      These 86 projects are the <strong>primary vertex seeds</strong> for PG Atlas: Developer Tooling or Infrastructure & Services, active on Mainnet or in active Development, Soroban-enabled, with a GitHub URL.
      <strong>Funding tier ≠ criticality score</strong> — Reflector and AnChain.AI top the funding list, but criticality (A9) will be determined by transitive dependent count, not dollars awarded.
      The 22 projects at exactly <strong>$150K</strong> indicate the SCF round funding cap; many are comparably important for the dependency graph.
    </div>
  </div>
  <div style="display:flex; flex-direction:column; gap:20px;">
    <div class="card">
      <div class="card-title">
        PG Seeds — Integration Status
        <span class="card-tag">86 seeds</span>
      </div>
      <div class="chart-wrap"><canvas id="statusChart" height="180"></canvas></div>
      <div class="legend-box" style="font-size:10px;">
        <strong>Mainnet (58, 67%)</strong>: production-live, highest pony-factor risk.
        <strong>Development (27, 31%)</strong>: active build; commit velocity is the primary signal.
        <strong>Testnet (1)</strong>: near-launch. All three status groups feed the A6 active subgraph projection.
      </div>
    </div>
    <div class="card">
      <div class="card-title">
        Submission Tranche Completion Funnel
        <span class="card-tag">758 submissions</span>
      </div>
      <div id="funnelViz"></div>
      <div class="legend-box" style="font-size:10px;">
        Of 758 submissions, only 93 (12%) reached <strong>Mainnet</strong> — the final tranche.
        62 stopped at MVP, 25 at Testnet. This 12% mainnet rate underscores why PG Atlas prioritizes
        <em>active, live</em> projects: most funded work never reaches production maturity.
      </div>
    </div>
  </div>
</div>

<!-- Row 3: Soroban Adoption + GitHub Orgs -->
<div class="grid-2">
  <div class="card">
    <div class="card-title">
      Soroban Adoption Rate by Round (% of submissions)
      <span class="card-tag">SCF #30 → #40</span>
    </div>
    <div class="chart-wrap"><canvas id="sorobanChart" height="200"></canvas></div>
    <div class="legend-box">
      Soroban adoption emerged sharply at <strong>SCF #30</strong> (86% of submissions in that round were Soroban-based), stabilizing at <strong>50–70%</strong> in subsequent rounds.
      This plateau reflects a permanent architectural shift in the ecosystem — Soroban is now the default smart contract environment.
      The 387 Soroban projects in the corpus are the natural target population for PG Atlas dependency tracking.
    </div>
  </div>
  <div class="card">
    <div class="card-title">
      Top GitHub Organizations (PG Seed Universe)
      <span class="card-tag">A6 Crawler Root Nodes</span>
    </div>
    <div class="chart-wrap"><canvas id="orgsChart" height="200"></canvas></div>
    <div class="legend-box">
      These 78 GitHub orgs are the <strong>root node set</strong> for the A6 registry crawl — the starting BFS frontier for the dependency graph.
      Multi-project orgs (Soneso, BP Ventures, Inferara, Withobsrvr, Creit-tech, 57Blocks) each operate umbrella organizations; their full repo lists must be enumerated, not just the named projects.
      A GitLab org (InfStones) and two <code>github.com/orgs/</code>-pattern URLs require manual resolution before the crawl runs.
    </div>
  </div>
</div>

</div><!-- /main -->

<!-- ── FOOTER ──────────────────────────────────────────────── -->
<div class="footer">
  <span>SCF Public Goods Atlas · Jay Gutierrez, PhD · Graph Analytics Lead · SCF #41 Proposal — $150K · Feb 24, 2026</span>
  <span>Data source: <strong>SCF Airtable base app8tLjMIDrjeloWN</strong> · Owner: Jay Gutierrez · Processed 579 projects, 758 submissions, 48 rounds</span>
</div>

<script>
const DATA = {"kpis": {"total_usd_m": 52.9, "active_projects": 345, "pg_seeds": 86, "soroban_projects": 387, "github_orgs": 78, "ended_rounds": 40}, "cat_data": [{"cat": "Applications", "usd_m": 21.6, "count": 247}, {"cat": "Financial Protocols", "usd_m": 11.03, "count": 82}, {"cat": "Developer Tooling", "usd_m": 10.05, "count": 127}, {"cat": "Infrastructure & Services", "usd_m": 8.2, "count": 90}, {"cat": "Education & Community", "usd_m": 1.71, "count": 29}, {"cat": "End-User Application", "usd_m": 0.32, "count": 4}], "top_seeds": [{"title": "Reflector", "usd": 444840.0, "cat": "Infrastructure & Services", "status": "Mainnet"}, {"title": "AnChain.AI", "usd": 435000.0, "cat": "Developer Tooling", "status": "Mainnet"}, {"title": "Stellarchain.io", "usd": 240635.0, "cat": "Infrastructure & Services", "status": "Mainnet"}, {"title": "Scout", "usd": 240000.0, "cat": "Developer Tooling", "status": "Mainnet"}, {"title": "Stellar PHP SDK", "usd": 225000.0, "cat": "Developer Tooling", "status": "Mainnet"}, {"title": "CommuniDAO", "usd": 219200.0, "cat": "Developer Tooling", "status": "Mainnet"}, {"title": "Smart Deploy", "usd": 194800.0, "cat": "Developer Tooling", "status": "Mainnet"}, {"title": "Mercury", "usd": 172000.0, "cat": "Infrastructure & Services", "status": "Mainnet"}, {"title": "SorobanPulse", "usd": 168500.0, "cat": "Infrastructure & Services", "status": "Mainnet"}, {"title": "zkFetch: zkTLS-Powered Oracle Solution", "usd": 166000.0, "cat": "Infrastructure & Services", "status": "Mainnet"}, {"title": "AssemblyScript Soroban SDK", "usd": 158460.0, "cat": "Developer Tooling", "status": "Mainnet"}, {"title": "BPV StellarMesh Anchor", "usd": 150000.0, "cat": "Infrastructure & Services", "status": "Mainnet"}, {"title": "Public Node", "usd": 150000.0, "cat": "Infrastructure & Services", "status": "Mainnet"}, {"title": "Gateway.fm", "usd": 150000.0, "cat": "Infrastructure & Services", "status": "Mainnet"}, {"title": "InfStones", "usd": 150000.0, "cat": "Infrastructure & Services", "status": "Mainnet"}, {"title": "Volta Circuit", "usd": 150000.0, "cat": "Infrastructure & Services", "status": "Mainnet"}, {"title": "Range: Cross-chain intelligence platform", "usd": 150000.0, "cat": "Infrastructure & Services", "status": "Mainnet"}, {"title": "human.tech", "usd": 150000.0, "cat": "Infrastructure & Services", "status": "Mainnet"}, {"title": "Digicus", "usd": 150000.0, "cat": "Developer Tooling", "status": "Mainnet"}, {"title": "Komet: Formal Verification", "usd": 150000.0, "cat": "Developer Tooling", "status": "Mainnet"}], "round_series": [{"name": "SCF #9", "num": 9, "usd_k": 918.2, "voters": 49}, {"name": "SCF #10", "num": 10, "usd_k": 1124.2, "voters": 52}, {"name": "SCF #11", "num": 11, "usd_k": 1134.0, "voters": 45}, {"name": "SCF #13", "num": 13, "usd_k": 1267.3, "voters": 21}, {"name": "SCF #14", "num": 14, "usd_k": 509.1, "voters": 24}, {"name": "SCF #15", "num": 15, "usd_k": 1112.7, "voters": 23}, {"name": "SCF #16", "num": 16, "usd_k": 1901.8, "voters": 24}, {"name": "SCF #17", "num": 17, "usd_k": 1959.3, "voters": 26}, {"name": "SCF #18", "num": 18, "usd_k": 1411.7, "voters": 27}, {"name": "SCF #19", "num": 19, "usd_k": 1253.5, "voters": 18}, {"name": "SCF #20", "num": 20, "usd_k": 1402.6, "voters": 31}, {"name": "SCF #21", "num": 21, "usd_k": 1479.4, "voters": 23}, {"name": "SCF #22", "num": 22, "usd_k": 1417.3, "voters": 20}, {"name": "SCF #23", "num": 23, "usd_k": 1606.1, "voters": 32}, {"name": "SCF #24", "num": 24, "usd_k": 1427.7, "voters": 23}, {"name": "SCF #25", "num": 25, "usd_k": 1349.9, "voters": 40}, {"name": "SCF #26", "num": 26, "usd_k": 2289.9, "voters": 44}, {"name": "SCF #27", "num": 27, "usd_k": 1489.7, "voters": 39}, {"name": "SCF #28", "num": 28, "usd_k": 1557.8, "voters": 43}, {"name": "SCF #29", "num": 29, "usd_k": 2278.6, "voters": 44}, {"name": "SCF #30", "num": 30, "usd_k": 2167.9, "voters": 34}, {"name": "SCF #31", "num": 31, "usd_k": 2068.7, "voters": 38}, {"name": "SCF #32", "num": 32, "usd_k": 1377.5, "voters": 30}, {"name": "SCF #33", "num": 33, "usd_k": 1033.6, "voters": 50}, {"name": "SCF #34", "num": 34, "usd_k": 1717.3, "voters": 36}, {"name": "SCF #35", "num": 35, "usd_k": 1865.3, "voters": 48}, {"name": "SCF #36", "num": 36, "usd_k": 2088.7, "voters": 47}, {"name": "SCF #37", "num": 37, "usd_k": 1861.4, "voters": 44}, {"name": "SCF #38", "num": 38, "usd_k": 2568.8, "voters": 104}, {"name": "SCF #39", "num": 39, "usd_k": 1115.7, "voters": 120}, {"name": "SCF #40", "num": 40, "usd_k": 2182.1, "voters": 0}], "status_counts": {"Mainnet": 58, "Development": 27, "Testnet": 1}, "tranche_funnel": {"Awarded": 35, "MVP Complete": 62, "Testnet": 25, "Mainnet": 93}, "soroban_series": [{"name": "SCF #30", "pct": 86.4, "soroban": 19, "total": 22}, {"name": "SCF #31", "pct": 59.1, "soroban": 13, "total": 22}, {"name": "SCF #32", "pct": 64.7, "soroban": 11, "total": 17}, {"name": "SCF #33", "pct": 50.0, "soroban": 7, "total": 14}, {"name": "SCF #35", "pct": 57.1, "soroban": 12, "total": 21}, {"name": "SCF #36", "pct": 69.6, "soroban": 16, "total": 23}, {"name": "SCF #37", "pct": 52.6, "soroban": 10, "total": 19}, {"name": "SCF #38", "pct": 58.3, "soroban": 14, "total": 24}, {"name": "SCF #39", "pct": 66.7, "soroban": 8, "total": 12}, {"name": "SCF #40", "pct": 58.3, "soroban": 14, "total": 24}], "top_orgs": [{"org": "soneso", "count": 2}, {"org": "bp-ventures", "count": 2}, {"org": "inferara", "count": 2}, {"org": "withobsrvr", "count": 2}, {"org": "creit-tech", "count": 2}, {"org": "57blocks", "count": 2}, {"org": "reflector-network", "count": 1}, {"org": "anchainai", "count": 1}, {"org": "stellarchain", "count": 1}, {"org": "coinfabrik", "count": 1}, {"org": "communidao", "count": 1}, {"org": "tenk-dao", "count": 1}, {"org": "xycloo", "count": 1}, {"org": "crosschainlabs-stellar", "count": 1}, {"org": "reclaimprotocol", "count": 1}]};

Chart.defaults.color = '#64748b';
Chart.defaults.borderColor = '#1e2d45';
Chart.defaults.font.family = "'Inter', -apple-system, sans-serif";

// ── 1. Category Donut ────────────────────────────────────────
new Chart(document.getElementById('catChart'), {
  type: 'doughnut',
  data: {
    labels: DATA.cat_data.map(d => d.cat),
    datasets: [{
      data: DATA.cat_data.map(d => d.usd_m),
      backgroundColor: ['#3b82f6','#8b5cf6','#10b981','#06b6d4','#f59e0b','#ef4444'],
      borderWidth: 0,
      hoverOffset: 6,
    }]
  },
  options: {
    cutout: '60%',
    plugins: {
      legend: { position:'bottom', labels:{ boxWidth:10, padding:10, font:{size:11} } },
      tooltip: {
        callbacks: {
          label: ctx => ` $${ctx.parsed.toFixed(2)}M — ${DATA.cat_data[ctx.dataIndex].count} projects`
        }
      }
    }
  }
});

// ── 2. Round Trend (bar + line combo) ────────────────────────
const rs = DATA.round_series;
new Chart(document.getElementById('roundChart'), {
  type: 'bar',
  data: {
    labels: rs.map(r => r.name),
    datasets: [
      {
        label: 'Funding ($K)',
        data: rs.map(r => r.usd_k),
        backgroundColor: rs.map(r => r.num >= 30 ? 'rgba(59,130,246,0.7)' : 'rgba(59,130,246,0.25)'),
        borderRadius: 3,
        yAxisID: 'y',
      },
      {
        label: 'Voters',
        data: rs.map(r => r.voters || null),
        type: 'line',
        borderColor: '#10b981',
        backgroundColor: 'rgba(16,185,129,0.08)',
        tension: 0.4,
        pointRadius: 3,
        pointBackgroundColor: '#10b981',
        yAxisID: 'y1',
        fill: true,
      }
    ]
  },
  options: {
    plugins: { legend: { labels: { boxWidth:10, font:{size:11} } } },
    scales: {
      x: { ticks: { font:{size:9}, maxRotation:60 } },
      y: { title: { display:true, text:'Funding $K', font:{size:10} }, grid:{color:'rgba(30,45,69,0.8)'} },
      y1: { position:'right', title:{ display:true, text:'Voters', font:{size:10} }, grid:{display:false} }
    }
  }
});

// ── 3. Seed Table ─────────────────────────────────────────────
const maxUsd = DATA.top_seeds[0].usd;
const tbody = DATA.top_seeds.map((s, i) => {
  const pct = Math.round((s.usd / maxUsd) * 100);
  const catClass = s.cat.includes('Infrastructure') ? 'cat-infra' : 'cat-dev';
  const catLabel = s.cat.includes('Infrastructure') ? 'Infra' : 'Dev Tooling';
  const sdotClass = s.status === 'Mainnet' ? 'status-mainnet' : s.status === 'Development' ? 'status-development' : 'status-testnet';
  const usdFmt = s.usd >= 1000 ? `$${(s.usd/1000).toFixed(0)}K` : `$${s.usd}`;
  const title = s.title.length > 26 ? s.title.substring(0,25)+'…' : s.title;
  return `<tr>
    <td class="rank">${i+1}</td>
    <td class="proj-name">${title}</td>
    <td><span class="cat-badge ${catClass}">${catLabel}</span></td>
    <td><span class="status-dot ${sdotClass}"></span><span style="font-size:11px;color:#94a3b8;">${s.status}</span></td>
    <td>
      <div class="usd-bar-wrap">
        <div class="usd-bar" style="width:${pct}px;min-width:4px;"></div>
        <span class="usd-val">${usdFmt}</span>
      </div>
    </td>
  </tr>`;
}).join('');
document.getElementById('seedTable').innerHTML = `
  <table class="seed-table">
    <thead><tr>
      <th>#</th><th>Project</th><th>Category</th><th>Status</th><th>SCF Funding</th>
    </tr></thead>
    <tbody>${tbody}</tbody>
  </table>`;

// ── 4. Status Donut ───────────────────────────────────────────
new Chart(document.getElementById('statusChart'), {
  type: 'doughnut',
  data: {
    labels: ['Mainnet (67%)', 'In Development (31%)', 'Testnet (1%)'],
    datasets: [{
      data: [58, 27, 1],
      backgroundColor: ['#22c55e','#f59e0b','#3b82f6'],
      borderWidth: 0,
    }]
  },
  options: {
    cutout: '55%',
    plugins: {
      legend: { position:'bottom', labels:{ boxWidth:10, padding:8, font:{size:10} } },
      tooltip: { callbacks: { label: ctx => ` ${ctx.parsed} projects` } }
    }
  }
});

// ── 5. Tranche Funnel ─────────────────────────────────────────
const stages = [
  { label: 'Awarded (any tranche)', count: 758, color: '#3b82f6' },
  { label: 'MVP Complete', count: 62, color: '#8b5cf6' },
  { label: 'Testnet', count: 25, color: '#06b6d4' },
  { label: 'Mainnet ✓', count: 93, color: '#10b981' },
];
const maxStage = stages[0].count;
document.getElementById('funnelViz').innerHTML = stages.map(s => `
  <div class="funnel-item">
    <div class="funnel-label">
      <span>${s.label}</span>
      <span>${s.count} (${Math.round(s.count/maxStage*100)}%)</span>
    </div>
    <div class="funnel-track">
      <div class="funnel-fill" style="width:${Math.max(s.count/maxStage*100,3)}%;background:${s.color};"></div>
    </div>
  </div>`).join('');

// ── 6. Soroban Adoption Line ──────────────────────────────────
const sor = DATA.soroban_series.filter(s => s.total > 0);
new Chart(document.getElementById('sorobanChart'), {
  type: 'line',
  data: {
    labels: sor.map(s => s.name),
    datasets: [{
      label: '% Soroban submissions',
      data: sor.map(s => s.pct),
      borderColor: '#8b5cf6',
      backgroundColor: 'rgba(139,92,246,0.1)',
      tension: 0.4,
      fill: true,
      pointBackgroundColor: '#8b5cf6',
      pointRadius: 4,
    }]
  },
  options: {
    plugins: { legend: { labels: { font:{size:11} } } },
    scales: {
      y: { min:0, max:100, title:{display:true,text:'% Soroban',font:{size:10}}, grid:{color:'rgba(30,45,69,0.8)'} },
      x: { ticks: { font:{size:10} } }
    }
  }
});

// ── 7. GitHub Orgs Horizontal Bar ────────────────────────────
const orgs = DATA.top_orgs.slice(0,12);
new Chart(document.getElementById('orgsChart'), {
  type: 'bar',
  data: {
    labels: orgs.map(o => o.org),
    datasets: [{
      label: 'PG Seed Projects',
      data: orgs.map(o => o.count),
      backgroundColor: orgs.map((o,i) => i < 6 ? 'rgba(6,182,212,0.7)' : 'rgba(6,182,212,0.35)'),
      borderRadius: 4,
    }]
  },
  options: {
    indexAxis: 'y',
    plugins: { legend: { display:false } },
    scales: {
      x: { ticks:{stepSize:1, font:{size:10}}, title:{display:true,text:'Projects',font:{size:10}}, grid:{color:'rgba(30,45,69,0.8)'} },
      y: { ticks:{font:{size:11}} }
    }
  }
});
</script>
</body>
</html>
